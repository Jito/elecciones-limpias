$(document).ready(function(){$("#map").gmap3({getgeoloc:{callback:function(e){e&&$(this).gmap3({map:{options:{center:e,zoom:16,mapTypeId:google.maps.MapTypeId.TERRAIN,mapTypeControl:!1,navigationControl:!1,streetViewControl:!1,overviewMapControl:!1}}})}}});$("#submission-form").easyWizard({showSteps:!1,showButtons:!1,submitButton:!1,debug:!0,after:function(e,t,n){if(n.attr("id")=="step-locate"){var r,i=$("#map").gmap3("get"),s=function(e){console.log(e);$("#submission-lat").val(e.lat());$("#submission-lng").val(e.lng())};$("#step-locate-done").button("loading");$("#map").gmap3({getgeoloc:{callback:function(e){e?r=e:r=i.getCenter();s(r);$(this).gmap3({getmaxzoom:{latLng:r,callback:function(e){i.setCenter(r);i.setZoom(e-1)}},marker:{latLng:r,options:{animation:google.maps.Animation.DROP,draggable:!0},events:{dragend:function(e,t,n){s(e.getPosition())}}}});$("#step-locate-done").button("reset")}}})}}});$("#submission-file").fileupload({dataType:"json",url:"/upload",previewMaxWidth:200,previewMaxHeight:200,previewCrop:!0,add:function(e,t){$.each(t.files,function(e,n){var r=loadImage(n,function(e){$("#upload-preview").html(e)},{maxWidth:150,maxHeight:150,crop:!0});r&&$("#submission-form").easyWizard("nextStep");$("#cancel").click(function(){t.abort();$(".step-upload").show();$(".step-positioning").hide();$("#upload-preview").html("")})})},done:function(e,t){$("#upload-preview").html("");$("#submission-form").easyWizard("nextStep")}})});